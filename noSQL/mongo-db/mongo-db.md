# MongoDB

Является noSQL базой данных, которая хранит данные в виде object (json).

### Согласованность (Consistency)
MongoDB может обеспечивать согласованность данных, если включен режим `primary` для репликации.
В этом режиме MongoDB будет выбирать один узел (primary), который будет осуществлять запись данных 
и распространят изменения на остальные узлы (secondary). При этом, если узел primary недоступен,
то ни один из узлов не сможет осуществлять запись данных, пока mongoDB 
автоматически не выберет новый primary узел. 

### Доступность (Availability)
MongoDB обеспечивает высокую доступность для чтения и записи, но только в режиме `primary` 
и эта доступность может уменьшаться в случае разделения сети. 

### Устойчивость к разделению (Partition tolerance)
MongoDB обеспечивает хорошую устойчивость к разделению и может продолжать работать 
даже при разделениии сети. 

## MongoDB в зависимости от настроек может быть как CP, так и AP

### CP (Consistency, Partition tolerance) 
> В этом режиме MongoDB будет придерживаться сильной согласованности данных, то есть 
> все операции на запись будут завершаться только после того, как данные станут доступны 
> для чтения на всех узлах. 
> 
> Режим CP обеспечивает согласованность данных, но может привести к снижению доступности, 
> в случае сбоя "primary" узла или разделения сети. 

Настройки для режима CP:
* Включить режим репликации. 
* Установить высокий уровень WriteConcern для записи данных:

```javascript
db.collection.insertOne(
  {key: "value"},
  {writeConcern: {w: "majority"}}
);
```
* Установить журнализацию (Journaling) - это механизм, который позволяет восстанавливать
данные после сбоев.

### AP (Availability, Partition tolerance)
> В этом режиме MongoDB будет придерживаться слабой согласованности данных, то есть
> операции на запись будут завершаться сразу после того, как данные будут записаны
> на primary узел, без потверждения от secondary узлов.

* Включить режим репликации.
* Установить низкий уровень WriteConcern для записи данных:

```javascript
db.collection.insertOne(
  {key: "value"},
  {writeConcern: {w: 1}}
);
```

* Использовать режим "secondaryPreferred" для чтения данных:
```javascript
db.collection.find().readPref("secondaryPreferred");
```
при этом режиме, операции на чтение будут выполняться на secondary узлах, 
если они доступны, и на primary узле, если secondary узлы недоступны.

* Включить асинхронную репликацию secondary узлов. 
